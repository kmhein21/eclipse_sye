---
title: "Graphing First WAV and Obtaining Indices"
format: html
---
```{r}
library(soundecology)
library(tuneR)
library(here)
library(ggplot2)
library(readr)
```

### Acoustic Complexity Plot of WAV - 240401_0616100
```{r}
WAV_0616100_240401<-readWave(here("wav_files/20240401_061600.WAV"))

ACI_01<-acoustic_complexity(WAV_0616100_240401)
ACI_01_val<-ACI_01$aci_fl_left_vals
df_ACI<-as.data.frame(ACI_01$aci_fl_left_vals)

plot(x=1:256, y=ACI_01_val, col="orange", pch=16)

ggplot(data=df_ACI, aes(x=1:256, y=ACI_01$aci_fl_left_vals))+
  geom_line(col="orange")+
  theme_minimal()+
  labs(x = "Time(s)", y = "Acoustic Complexity")

```
Not sure about x-axis, how to label for the actual measurement of time present

### Other Indices for this file: 

Bioacoustic Index for WAV - 240401_0616100
```{r}
Bioindex1<-bioacoustic_index(WAV_0616100_240401)
```

Acoustic Diversity Index for WAV - 240401_0616100
```{r}
ADI1<-acoustic_diversity(WAV_0616100_240401)

ADI1_lv<-as.data.frame(ADI1$left_band_values)

ggplot(data=ADI1_lv, aes(x=1:10, y=ADI1$left_band_values))+
  geom_point()+
  theme_minimal()
```

Acoustic Evenness Index for WAV - 240401_0616100
```{r}
AEI_1<-acoustic_evenness(WAV_0616100_240401)
```

Attempting to use the multiple sounds function (on 10 WAV files)

```{r}
multiple_sounds(directory = "wav_files", resultfile = "WAV5_ACI.csv", soundindex = "acoustic_complexity", no_cores="max")
```

```{r}
WAV5_ACI <- read_csv("WAV5_ACI.csv")
```

Returns singular indices but does not return the list of values used to create the acoustic complexity plot like above. "aci_fl_left_vals"

### Making Acoustic Complexity plots for more WAV-Files:

```{r}
WAV_063200_240401<-readWave(here("wav_files/20240401_063200.WAV"))

ACI_02<-acoustic_complexity(WAV_063200_240401)
ACI_02_val<-ACI_02$aci_fl_left_vals
df_ACI2<-as.data.frame(ACI_02$aci_fl_left_vals)

ggplot(data=df_ACI2, aes(x=1:256, y=ACI_02$aci_fl_left_vals))+
  geom_line(col="purple")+
  theme_minimal()+
  labs(x = "Time(s)", y = "Acoustic Complexity")
```

```{r}
WAV_054600_240403<-readWave(here("wav_files/20240403_054600.WAV"))

ACI_03<-acoustic_complexity(WAV_054600_240403)
ACI_03_val<-ACI_03$aci_fl_left_vals
df_ACI3<-as.data.frame(ACI_03$aci_fl_left_vals)

ggplot(data=df_ACI3, aes(x=1:256, y=ACI_03$aci_fl_left_vals))+
  geom_line(col="green")+
  theme_minimal()+
  labs(x = "Time(s)", y = "Acoustic Complexity")
```


A004-SD012-04-07
```{r}
library(soundecology)
library(tidyverse)
library(here)
library(hms)
```

```{r}
A4_7_paths <- list.files(here("A004_SD012_04_07"), pattern = "\\.WAV$",
                    full.names = TRUE)

wav_files_47 <- map(A4_7_paths, readWave)
AEI_allWAV_47<-map(wav_files_47, acoustic_evenness)
BEI_allWAV_47<-map(wav_files_47, bioacoustic_index)
ADI_allWAV_47<-map(wav_files_47, acoustic_diversity)
ACI_allWAV_47<-map(wav_files_47, acoustic_complexity)
ndsi_allWAV_47<-map(wav_files_47, soundecology::ndsi)
```

Single value indices - Biophony, BEI, and AEI

```{r}
AEI_4_7<-as.data.frame(AEI_allWAV_47)|>
  select(starts_with("aei_left"))|>
  pivot_longer(everything(), names_to = "aei_name", values_to = "AEI")|>
  select("AEI")

BEI_4_7<-as.data.frame(BEI_allWAV_47)|>
  select(starts_with("left_area"))|>
  pivot_longer(everything(), names_to = "bei_name", values_to = "BEI")|>
  select("BEI")

Bio_4_7<-as.data.frame(ndsi_allWAV_47)|>
  select(starts_with("biophony_left"))|>
  pivot_longer(everything(), names_to = "biophony_name", values_to = "Biophony")|>
  select("Biophony")

paths_date <-str_remove(A4_7_paths, paste0(here(), "/A004_SD012_04_07"))

single_indices<-as_tibble(cbind(paths_date, AEI_4_7, BEI_4_7, Bio_4_7))

```

Multiple Indices - ACI and ADI 

For loop making lists of left values
```{r}
ACI_all_47<-vector("list", length(c(1:350)))
ADI_all_47<-vector("list", length(c(1:350)))
n<-350
for (i in 1:n){
    ACI_all_47[i]<-(as.data.frame(ACI_allWAV_47[[i]]$aci_fl_left_vals))
    ADI_all_47[i]<-(as.data.frame(ADI_allWAV_47[[i]]$left_band_values))
} 

```

```{r}
multiple_indices<-as.tibble(cbind(ADI_all_47, ACI_all_47))

df_names<- c("Paths_date", "AEI", "BEI", "Biophony", "ADI","ACI")

Full_4_7_df<-bind_cols(single_indices,multiple_indices)
names(Full_4_7_df)<-df_names

New_df_4_7<-Full_4_7_df|>
  mutate(Biophony = as.numeric(Biophony),
         AEI = as.numeric(AEI),
         BEI = as.numeric(BEI))|>
  separate(Paths_date, into = c("Date", "Time"), sep = "_")|>
  separate(Time, into = c("time", "temp"), sep = "\\.")|>
  separate(time, into = c("hours","other"), sep = 2)|>
  separate(other, into = c("min", "sec"), sep = 2)|>
  mutate(Date = parse_number(Date))|>
  unite("time", c("Date","hours", "min","sec"), sep = ":")|>
  mutate(time = ymd_hms(time))|>
  select(-temp)

save(New_df_4_7, file = "A004_SD012_04_07.rda")
load("A004_SD012_04_07.rda")
```

A004_SD012_04_08

```{r}
A4_8_paths <- list.files(here("A004_SD012_04_08"), pattern = "\\.WAV$",
                    full.names = TRUE)

wav_files_48 <- map(A4_8_paths, readWave)
AEI_allWAV_48<-map(wav_files_48, acoustic_evenness)
BEI_allWAV_48<-map(wav_files_48, bioacoustic_index)
ADI_allWAV_48<-map(wav_files_48, acoustic_diversity)
ACI_allWAV_48<-map(wav_files_48, acoustic_complexity)
ndsi_allWAV_48<-map(wav_files_48, soundecology::ndsi)
```

Single Indices - Acoustic evenness, bioacoustic index, and biophony
```{r}
AEI_4_8<-as.data.frame(AEI_allWAV_48)|> 
  select(starts_with("aei_left"))|>
  pivot_longer(everything(), names_to = "aei_name", values_to = "AEI")

BEI_4_8<-as.data.frame(BEI_allWAV_48)|>
  select(starts_with("left_area"))|>
  pivot_longer(everything(), names_to= "bei_name", values_to = "BEI")

Biophony_4_8<-as.data.frame(ndsi_allWAV_48)|>
  select(starts_with("biophony_left"))|>
  pivot_longer(everything(), names_to = "bio_name", values_to = "Biophony")

paths_date <-str_remove(A4_8_paths, paste0(here(), "/A004_SD012_04_08"))
single_indices_48<-cbind(paths_date,AEI_4_8$AEI, BEI_4_8$BEI, Biophony_4_8$Biophony )

```

Multiple Indices
```{r}
ACI_all_48<-vector("list", length(c(1:350)))
ADI_all_48<-vector("list", length(c(1:350)))
n<-350
for (i in 1:n){
    ACI_all_48[i]<-(as.data.frame(ACI_allWAV_48[[i]]$aci_fl_left_vals))
    ADI_all_48[i]<-(as.data.frame(ADI_allWAV_48[[i]]$left_band_values))
} 

multiple_indices_48<-as.tibble(cbind(ADI_all_48, ACI_all_48))
```

Compiling all into one data frame 

```{r}
Full_4_8<-bind_cols(single_indices_48, multiple_indices_48)
names(Full_4_8)<-df_names

New_df_4_8<-Full_4_8|>
  mutate(Biophony = as.numeric(Biophony),
         AEI = as.numeric(AEI),
         BEI = as.numeric(BEI))|>
  separate(Paths_date, into = c("Date", "Time"), sep = "_")|>
  separate(Time, into = c("time", "temp"), sep = "\\.")|>
  separate(time, into = c("hours","other"), sep = 2)|>
  separate(other, into = c("min", "sec"), sep = 2)|>
  mutate(Date = parse_number(Date))|>
  unite("time", c("Date","hours", "min","sec"), sep = ":")|>
  mutate(time = ymd_hms(time))|>
  select(-temp)

save(New_df_4_8, file = "A004_SD012_04_08.rda")
load("A004_SD012_04_08.rda")
```

```{r}
both_days <- bind_rows(New_df_4_7, New_df_4_8) |>
  mutate(day = as.factor(lubridate::day(time)),
         only_time = hms::as_hms(time))

ggplot(data = both_days, aes(x = only_time, y = Biophony, color = day))+
  geom_line()+
  scale_color_viridis_d()+
  theme_minimal()+
  labs(title = "Biophony")

ggplot(data = both_days, aes(x = only_time, y = AEI, color = day))+
  geom_line()+
  scale_color_viridis_d()+
  theme_minimal()+
  labs(title = "Acoustic Evenness")

ggplot(data = both_days, aes(x = only_time, y = BEI, color = day))+
  geom_line()+
    scale_color_viridis_d()+
  theme_minimal()+
  labs(title = "Bioacoustic Evenness")

```




