---
title: "Creating Data Frame of ACIs"
format: html
---

Loading Packages and Mapping functions onto WAV files 
```{r}
library(purrr)
library(soundecology)
library(tidyverse)
library(here)
library(stringr)
paths <- list.files(here("wav_files"), pattern = "\\.WAV$",
                    full.names = TRUE)


wav_files <- map(paths, readWave)
AEI_allWAV<-map(wav_files, acoustic_evenness)
BEI_allWAV<-map(wav_files, bioacoustic_index)
ADI_allWAV<-map(wav_files, acoustic_diversity)
ACI_allWAV<-map(wav_files, acoustic_complexity)
ndsi_allWAV<-map(wav_files, soundecology::ndsi)
```

Acoustic Evenness, Biophony, and Bioacoustic Indices 
```{r}
AEI_df<-as.data.frame(AEI_allWAV)|>
  select(starts_with("aei_left"))|>
  pivot_longer(cols = everything(), names_to = "aei_name",
               values_to = "AEI")

BEI_df<-as.data.frame(BEI_allWAV)|>
  select(starts_with("left_area"))|>
  pivot_longer(cols= everything(), names_to = "bei_name", values_to = "BEI")
  
paths_date <-str_remove(paths, paste0(here(), "/wav_files"))

Biophony_all<-as.data.frame(ndsi_allWAV)|>
  select(starts_with("biophony_left"))|>
  pivot_longer(cols = everything(), names_to = "biop_name", values_to = "Biophony")

```

Obtaining left values for Acoustic Diveristy and Acoustic Complexity indices 
```{r}
ACI_all<-vector("list", length(c(1:10)))
ADI_all<-vector("list", length(c(1:10)))
n<-10
for (i in 1:n){
    ACI_all[i]<-(as.data.frame(ACI_allWAV[[i]]$aci_fl_left_vals))
    ADI_all[i]<-(as.data.frame(ADI_allWAV[[i]]$left_band_values))
} 


ADI_df<-unnest(as.data.frame(ADI_all))
ACI_df<-unnest(as.data.frame(ACI_all))

```

```{r}

all_adi<-as.data.frame(ADI_allWAV)
New_adi<-all_adi|> select(starts_with("left_band"))|>
  select("left_bandrange_values", starts_with("left_band_values"))|>
  mutate("left_bandrange_values" = as.factor(left_bandrange_values))|>
  pivot_longer(cols = -"left_bandrange_values", names_to = "WAV", values_to = "Band_proportion")|>
  mutate(WAV = as.factor(WAV))

ggplot(data = New_adi, aes( x = left_bandrange_values, y = Band_proportion))+
  geom_col()+
  facet_wrap(~WAV)+
  theme_minimal()
```


Creating an Acoustic diversity data frame
```{r}
ADI_names<-c("ADI_1", "ADI_2", "ADI_3", "ADI_4", "ADI_5", "ADI_6", "ADI_7", "ADI_8","ADI_9", "ADI_10")

names(ADI_df)<-c(ADI_names)

ADI_2<-ADI_df|> mutate(num = rownames(ADI_df))|>
  select(num, everything())

ADI_Final<-ADI_2|>pivot_longer(cols = starts_with("ADI"), names_to = "WAV", values_to = "ADI")|>
  mutate(WAV = as.factor(WAV), num = as.integer(num))|>
  mutate(WAV = fct_relevel(WAV,c("ADI_1", "ADI_2", "ADI_3", "ADI_4", "ADI_5", "ADI_6", "ADI_7", "ADI_8","ADI_9", "ADI_10")))

```

Creating a line plot for Acoustic Diversity 
```{r}
ggplot(data = ADI_Final, aes(x=num, y = ADI))+
  geom_line(col = "green")+
  facet_wrap(~WAV)+
  theme_minimal()

```

Making Acoustic Complexity data frame 
```{r}
ACI_names<-c("ACI_1", "ACI_2", "ACI_3", "ACI_4", "ACI_5", "ACI_6", "ACI_7", "ACI_8","ACI_9", "ACI_10")
names(ACI_df)<-c(ACI_names)

ACI_2<-ACI_df|> mutate( num = rownames(ACI_df))|>
  select(num, everything())

ACI_Final<-ACI_2|>pivot_longer(cols = starts_with("ACI"), names_to = "WAV", values_to = "ACI")|>
  mutate(WAV = as.factor(WAV), num = as.integer(num))|>
  mutate(WAV = fct_relevel(WAV, c("ACI_1", "ACI_2", "ACI_3", "ACI_4", "ACI_5", "ACI_6", "ACI_7", "ACI_8","ACI_9", "ACI_10")) )

```

Creating a line plot for each WAV File
```{r}
ggplot(data=ACI_Final, aes(x = num , y=ACI))+
  geom_line(col="orange")+
  theme_minimal()+
  labs(x = "Time(s)", y = "Acoustic Complexity")+
  facet_wrap(~WAV)
```

Acoustic complexity does not seem to match completely with the WAV files, specifically the large spike at the beginning at towards the end of all the graphs. 

```{r}
arrange(ACI_3, ACI)
```

All lowest ACIs fall at "position 176"


Creating a full data frame with all indices (5)
```{r}

single_indices<-as.tibble(cbind(paths_date, AEI_df, BEI_df, Biophony_all))
multiple_indices<-as.tibble(cbind( ADI_all, ACI_all))

full_WAV_df<-bind_cols(single_indices, multiple_indices)|>
  separate(col = paths_date, into = c("Date_time", "nonsense"), sep = -4)|>
  select(-(ends_with("name")),-"nonsense")


save(full_WAV_df, file = "Initial_10_WAV.rda")
load("Initial_10_WAV.rda")
```

Due to CSV not allowing numeric list columns, I changed them into strings and then saved as a csv


